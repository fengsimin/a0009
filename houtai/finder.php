<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\x74\x61\57\x66\x69\156\144\x65\x72\57"; function __construct() { goto FiISW; oEeQE: $this->table = "\146\151\156\144\145\x72"; goto kBUKT; kBUKT: hjx2j: goto obIqX; obIqX: parent::__construct(); goto EK8K5; FiISW: if ($this->table) { goto hjx2j; } goto oEeQE; EK8K5: } protected function postAll($pid, $request_data) { goto j0jy3; yG5iA: $level = $this->db->select($this->table, "\x6c\x65\x76\145\x6c")->where(array("\x69\x64", "\75", $pid))->get(0); goto CVvMV; hNcqb: $paths = $this->db->select($this->table, array("\151\144", "\x6e\x61\x6d\x65"))->where(array("\151\x64", "\111\116", $level), "\101\116\104", array("\x74\171\x70\x65", "\75", "\x66\157\x6c\144\x65\162"))->all(); goto oa_Sm; OwiWn: $paths = array(); goto sSoZJ; oa_Sm: C2AMK: goto zscB1; CVvMV: $level = array_filter(explode("\54", $level)); goto hNcqb; j0jy3: $files = $this->db->select($this->table)->where($request_data["\x77\150\x65\162\145"])->order($request_data["\157\162\x64\x65\x72"])->all(); goto OwiWn; zscB1: return array("\146\151\x6c\145\x73" => $files, "\160\x61\164\x68\163" => $paths); goto CMjiG; sSoZJ: if (!$pid) { goto C2AMK; } goto yG5iA; CMjiG: } protected function postAdd($request_data) { goto CeOUB; bvdXh: $data["\x77\x69\144\164\150"] = $imagesize[0]; goto ZkOxg; ww1mD: return $this->error("\xe4\xb8\212\344\274\xa0\346\226\207\344\xbb\xb6\x20" . $name . "\x20\345\xa4\261\350\xb4\xa5\357\xbc\201"); goto SMRSQ; qFbEO: unlink($filename); goto MK4Gh; isur4: $filename = $this->_UTF82GBK("\x2e\56\x2f" . $path . $name); goto aCTBV; CeOUB: $path = $request_data["\160\x61\x74\x68"]; goto FjpTT; aCTBV: if (!(stripos($type, "\151\x6d\x61\147\145") !== false && is_file($filename))) { goto CrYqz; } goto wrKEl; VLKc9: rNFwQ: goto isur4; QK5Kk: UrRi4: goto wf2s9; wf2s9: $this->db->rollBack(); goto QKtfh; dfMAW: if ($id = $this->db->insert($this->table, $data)->id()) { goto FdMnu; } goto qFbEO; Nd6uD: $data["\x63\x74\x69\155\145"] = time(); goto oyIjE; Kvwv3: CrYqz: goto JR3xH; FjpTT: $name = $request_data["\156\141\155\145"]; goto J48Vs; EgeGS: $this->db->beginTransaction(); goto dfMAW; JnJG3: $data["\x6e\x61\155\x65"] = $name; goto YjifE; wFQ_K: $level = $this->_getLevel($id); goto AYYij; oyIjE: $data["\145\x78\164"] = end(explode("\x2e", $name)); goto EgeGS; LNFb2: $data["\x70\x69\x64"] = $foid ? $foid : 0; goto gcQS8; SMRSQ: FdMnu: goto wFQ_K; hGhMk: $foid = $request_data["\x66\x6f\x69\144"]; goto p8hAk; vZpzS: $this->db->commit(); goto Ji6Wv; AYYij: if (!$this->db->update($this->table, array("\x6c\x65\x76\145\154" => $level), array("\x69\x64", "\x3d", $id))->is()) { goto UrRi4; } goto vZpzS; wo_gX: if (mkdir($this->_UTF82GBK("\56\x2e\57" . $path), 511, true)) { goto NVCjg; } goto U7Xib; wrKEl: $imagesize = getimagesize($filename); goto bvdXh; YjifE: $data["\164\x79\160\x65"] = $type; goto LNFb2; QKtfh: return $this->error("\344\270\x8a\344\274\xa0\346\226\207\xe4\273\266\40" . $name . "\x20\xe5\xa4\xb1\xe8\xb4\245\xef\xbc\201"); goto Jj_0F; gcQS8: $data["\163\x69\x7a\145"] = $request_data["\163\x69\172\145"]; goto Nd6uD; JR3xH: $data["\160\x61\x74\x68"] = $path; goto JnJG3; vPZAA: NVCjg: goto VLKc9; p8hAk: if (is_dir($this->_UTF82GBK("\x2e\x2e\x2f" . $path))) { goto rNFwQ; } goto wo_gX; Ji6Wv: return $this->success(); goto QK5Kk; ZkOxg: $data["\150\145\151\x67\150\x74"] = $imagesize[1]; goto Kvwv3; J48Vs: $type = mime_content_type("\56\x2e\57" . $path . $name); goto hGhMk; MK4Gh: $this->db->rollBack(); goto ww1mD; U7Xib: return $this->error("\xe5\x88\233\345\273\xba\xe6\x96\x87\344\273\xb6\xe5\244\271\xe5\244\261\xe8\xb4\245\357\xbc\201"); goto vPZAA; Jj_0F: } protected function postMkdir($request_data) { goto IMD0P; fIku8: $data["\x6e\141\155\145"] = $name; goto qShBx; BTmoK: uOwvO: goto nKJtN; eAm4a: goto uOwvO; goto RBJhS; utL2J: yUT1b: goto eK0O_; wgb4p: $level = array_filter(explode("\54", $level)); goto JteuM; yLLXC: return $this->error("\345\x88\233\345\xbb\272\xe6\226\x87\344\273\266\xe5\244\xb9\xe5\xa4\xb1\xe8\264\245\357\274\201"); goto eAm4a; BGvZl: if (!($name === null || $name === '')) { goto LsIcM; } goto C0nkK; IMD0P: $pid = $request_data["\160\x69\x64"]; goto Vyzx2; JteuM: $folder = $this->db->select($this->table, "\x60\156\x61\155\145\x60")->where(array("\151\144", "\x49\116", $level), "\x41\x4e\x44", array("\164\x79\160\x65", "\75", "\x66\157\154\x64\x65\162"))->all(); goto FB3K7; zN19p: whaNz: goto iig7A; S_0vo: if ($id = $this->db->insert($this->table, $data)->id()) { goto zxw0k; } goto pM9HT; W7vJz: $level = $this->db->select($this->table, "\x60\x6c\145\166\145\154\140")->where(array("\151\x64", "\75", $pid))->get(0); goto FRnOo; vP20i: $this->db->rollBack(); goto yLLXC; ytH18: $this->db->commit(); goto o7vpm; Vyzx2: $name = $request_data["\156\141\155\145"]; goto BGvZl; DxG6k: $data = array(); goto fIku8; c1HEo: return $this->error("\345\210\233\345\273\272\346\226\207\344\273\xb6\xe5\244\271\345\xa4\xb1\xe8\xb4\xa5\357\274\201"); goto ze8jc; FB3K7: foreach ($folder as $value) { $folder_path .= $value["\x6e\141\x6d\145"] . "\x2f"; vu5fX: } goto em4GP; qShBx: $data["\160\x69\x64"] = $pid; goto ILc8F; JLoWw: return $this->error("\345\210\x9b\345\xbb\xba\346\x96\207\xe4\xbb\266\345\xa4\271\345\xa4\261\350\xb4\xa5\357\274\201"); goto gFom3; UwQy_: $this->db->beginTransaction(); goto HVPdR; o7vpm: return $this->success(); goto BTmoK; ILc8F: $folder_path = ''; goto W7vJz; WvxMI: if ($this->db->update($this->table, array("\154\145\x76\x65\x6c" => $level), array("\151\x64", "\75", $id))->is()) { goto euaok; } goto ILfK9; WhRsk: $data["\163\157\162\164\x62\x79"] = 1; goto FSuhC; p2XT2: if (!is_dir($dirname)) { goto yUT1b; } goto NF5U1; HVPdR: $data["\x70\141\x74\x68"] = $this->root . $folder_path; goto WhRsk; NF5U1: return $this->error($name . "\x20\xe6\x96\207\xe4\273\266\xe5\xa4\xb9\345\xb7\xb2\xe5\xad\x98\345\x9c\250\357\274\x81"); goto utL2J; YaDZw: $this->db->rollBack(); goto JLoWw; ze8jc: emyO4: goto UwQy_; FRnOo: if (!$level) { goto whaNz; } goto wgb4p; ILfK9: rmdir($dirname); goto vP20i; gFom3: zxw0k: goto YSBpZ; iig7A: $dirname = $this->_UTF82GBK("\x2e\56\x2f" . $this->root . $folder_path . $name); goto p2XT2; RBJhS: euaok: goto ytH18; eK0O_: if (mkdir($dirname, 493, true)) { goto emyO4; } goto c1HEo; C0nkK: return $this->error("\346\227\xa0\xe6\x95\210\347\232\x84\345\x8f\x82\xe6\225\260\357\xbc\x81"); goto odooT; pM9HT: rmdir($dirname); goto YaDZw; odooT: LsIcM: goto DxG6k; Xe8z8: $data["\143\x74\151\x6d\145"] = time(); goto S_0vo; em4GP: IX8jA: goto zN19p; YSBpZ: $level = $this->_getLevel($id); goto WvxMI; FSuhC: $data["\164\171\x70\145"] = "\146\x6f\154\144\x65\162"; goto Xe8z8; nKJtN: } protected function postRename($request_data) { goto iQluK; LqE9M: goto bkUX5; goto ze_DR; aMt_b: KIkeI: goto PmZFd; NanLF: goto QfNej; goto my0Zh; fkIq3: K1vK3: goto JEz6x; fvaiY: $newname = $this->_UTF82GBK("\x2e\x2e\x2f" . $path . $name); goto uC5kc; P_Fc5: goto l9XdS; goto uciAj; ji9x1: QfNej: goto mR3ez; jpI39: if ($this->db->update($this->table, array("\x6e\x61\x6d\x65" => $name), array("\x69\x64", "\x3d", $id))->is()) { goto wAye2; } goto hiH7h; TnJ3w: zOyJx: goto JrqAo; uC5kc: $this->db->beginTransaction(); goto RSkbX; YSQQH: return $this->error("\346\226\x87\xe4\xbb\xb6\345\xa4\271\351\x87\215\xe5\221\xbd\xe5\x90\215\xe5\xa4\xb1\350\xb4\xa5\357\xbc\x81"); goto NanLF; iQluK: $id = $request_data["\x69\x64"]; goto b9Rjl; hfytV: if (rename($oldname, $newname)) { goto aLfaB; } goto w83F4; v61Tr: rename($newname, $oldname); goto eQnh5; HHAeB: if (rename($oldname, $newname)) { goto fAGLn; } goto sxLS_; NaXu7: if ($this->db->update($this->table, array("\x6e\141\x6d\145" => $name), array("\x69\x64", "\75", $id))->is()) { goto u3ejA; } goto TxDEA; w1wQ6: $sublist = $this->db->select($this->table, array("\x69\x64", "\x6c\145\x76\145\x6c", "\x74\x79\160\x65"))->where(array("\x6c\145\166\145\154", "\114\111\x4b\105", "\45\x2c{$id}\54\45"))->all(); goto tt6f_; TxDEA: $this->db->rollBack(); goto aErrJ; JG5Pe: bkUX5: goto SX7Nh; IoTIa: $this->db->commit(); goto Qlv98; IGgxL: if (is_dir($oldname)) { goto bEIwO; } goto EUnvl; uVPya: goto PSUMj; goto Tcwgn; Rbbf4: return $this->success(); goto TnJ3w; xpHID: IU5Ea: goto LiJfE; kr9Mv: return $this->error("\xe6\x97\240\xe6\225\x88\347\232\x84\345\x8f\202\346\225\xb0\357\274\201"); goto fkIq3; AYG9P: if (!(!$id || $name === null || $name === '')) { goto K1vK3; } goto kr9Mv; AtWQQ: goto zOyJx; goto GTmaP; mR3ez: l9XdS: goto Oa2Ru; cHDv3: return $this->error("\346\x96\x87\xe4\273\xb6\351\207\x8d\xe5\x91\275\xe5\x90\215\345\xa4\261\xe8\264\xa5\xef\xbc\201"); goto AtWQQ; b9Rjl: $name = $request_data["\156\141\155\x65"]; goto AYG9P; siQD_: $this->db->commit(); goto Rbbf4; GTmaP: aLfaB: goto siQD_; C8Hw3: goto bkUX5; goto Y6eZi; JEz6x: $finder = $this->db->select($this->table, array("\160\141\x74\150", "\x6e\141\x6d\x65", "\x6c\x65\x76\x65\x6c"))->where(array("\x69\x64", "\x3d", $id))->get(); goto Rn_4n; LiJfE: $oldname = $this->_UTF82GBK("\56\56\57" . $path . $finder["\x6e\141\x6d\145"]); goto fvaiY; GFwi0: return $this->error("\346\x96\207\xe4\273\266\xe5\xa4\xb9\xe9\207\215\xe5\221\xbd\345\220\x8d\345\xa4\261\350\264\245\357\xbc\201"); goto vGfhs; uciAj: fAGLn: goto w1wQ6; ze_DR: bEIwO: goto jpI39; AjDkV: if (!(!$path || stripos($path, $this->root) === false)) { goto IU5Ea; } goto MX2hT; sxLS_: $this->db->rollBack(); goto u82qV; MX2hT: return $this->error("\xe6\227\240\xe6\225\210\xe7\232\204\350\xb7\xaf\xe5\276\x84\357\xbc\x81"); goto xpHID; w83F4: $this->db->rollBack(); goto cHDv3; aErrJ: return $this->error("\xe6\x96\x87\344\xbb\xb6\xe9\x87\x8d\xe5\x91\xbd\345\x90\215\345\244\xb1\xe8\264\245\xef\274\201"); goto uVPya; hKUfj: wAye2: goto HHAeB; u82qV: return $this->error($name . "\x20\346\226\207\xe4\xbb\xb6\345\244\xb9\345\xb7\262\345\255\x98\xe5\234\xa8\357\xbc\x81"); goto P_Fc5; Oa2Ru: OMZuR: goto JG5Pe; PmZFd: if ($is_path_update !== false) { goto Bi6xs; } goto v61Tr; Rn_4n: $path = $finder["\160\141\164\x68"]; goto AjDkV; Y6eZi: Y_8Tt: goto NaXu7; hiH7h: $this->db->rollBack(); goto GFwi0; eQnh5: $this->db->rollBack(); goto YSQQH; EUnvl: return $this->error("\346\211\xbe\344\xb8\215\345\x88\260\xe9\x87\215\xe5\221\xbd\xe5\x90\x8d\xe7\x9a\204\xe6\226\207\344\xbb\266\x2f\346\226\x87\xe4\xbb\xb6\xe5\xa4\xb9\357\xbc\201"); goto C8Hw3; tt6f_: foreach ($sublist as $sub) { goto RRFSy; X4R2L: if (!($is_path_update === false)) { goto CP16l; } goto qwjp8; d36YB: $level = array_filter(explode("\x2c", $sub["\x6c\x65\166\x65\x6c"])); goto dtqzt; RRFSy: if (!($sub["\154\x65\x76\145\154"] == $finder["\154\145\166\x65\154"])) { goto EqYJL; } goto ckV8D; dtqzt: foreach ($level as $lid) { goto AZ1oG; gGvad: if (!($sub["\164\171\160\145"] == "\146\x6f\154\x64\145\x72" && $sub["\154\145\x76\145\154"] == $levelobj["\x6c\145\166\x65\154"])) { goto fbzwu; } goto wj7Sy; A2X3m: $level_name = $levelobj["\156\x61\155\145"]; goto sW2LC; sW2LC: $newpath .= $level_name != '' ? $level_name . "\x2f" : ''; goto UFYVy; UFYVy: ZE11p: goto A4POf; wj7Sy: goto ZE11p; goto Y3fHD; Y3fHD: fbzwu: goto A2X3m; AZ1oG: $levelobj = $this->db->select($this->table, array("\x6e\x61\x6d\145", "\154\x65\166\145\154"))->where("\151\144\40\x3d\40{$lid}\40\101\x4e\x44\40\x74\x79\x70\x65\40\x3d\40\47\146\157\x6c\144\145\162\47")->get(); goto gGvad; A4POf: } goto RWFT0; tuKua: $is_path_update = $this->db->update($this->table, array("\160\141\164\x68" => $this->root . $newpath), array("\x69\144", "\75", $sub["\x69\x64"]))->is(); goto X4R2L; d2Rn0: CP16l: goto rgPdm; RWFT0: EwwCJ: goto tuKua; qwjp8: goto KIkeI; goto d2Rn0; ckV8D: goto mWJFY; goto UpGlH; UpGlH: EqYJL: goto mGRed; rgPdm: mWJFY: goto X6l6X; mGRed: $newpath = ''; goto d36YB; X6l6X: } goto aMt_b; my0Zh: Bi6xs: goto IoTIa; Tcwgn: u3ejA: goto hfytV; vGfhs: goto OMZuR; goto hKUfj; RSkbX: if (is_file($oldname)) { goto Y_8Tt; } goto IGgxL; Qlv98: return $this->success(); goto ji9x1; JrqAo: PSUMj: goto LqE9M; SX7Nh: } protected function postIsFile($request_data) { goto XpqJJ; hv0wI: return $this->success($name . "\40\346\x96\207\xe4\xbb\266\xe5\267\262\345\xad\x98\345\234\250\357\274\201"); goto xQ3fk; ekByL: goto YBRBe; goto Ui1Il; Ui1Il: Pnl7x: goto hv0wI; z1TSn: if (file_exists($this->_UTF82GBK("\x2e\56\57" . $path . $name))) { goto Pnl7x; } goto nyIE6; nyIE6: return $this->error($name . "\40\346\226\x87\344\xbb\xb6\xe4\xb8\x8d\xe5\255\230\345\234\250\xef\274\201"); goto ekByL; EUhv3: $name = $request_data["\156\141\x6d\x65"]; goto z1TSn; XpqJJ: $path = $request_data["\x70\x61\x74\150"]; goto EUhv3; xQ3fk: YBRBe: goto wpfKb; wpfKb: } protected function postDelete($request_data) { goto IiN_j; orO5s: return $this->success(); goto P1e4_; kdmFx: foreach ($ids as $id) { goto BZgqe; BZgqe: $file = $this->db->select($this->table, array("\160\141\164\x68", "\156\141\155\145"))->where(array("\x69\144", "\x3d", $id))->get(); goto x8e3C; S6L0R: goto rRXVq; goto IS7lI; dikHX: @unlink($filename); goto f5G3o; x8e3C: if ($file) { goto AUFie; } goto q03wO; wufSA: $this->_rmdir($filename); goto XDQzm; YVYQF: $name = $file["\156\141\155\145"]; goto Q0gM1; XDQzm: CCcRV: goto A2Rw8; hGj6L: ykHGp: goto FUM9n; JTmF4: AUFie: goto IuMpx; A2Rw8: rRXVq: goto hGj6L; Nw1WN: if (!$this->db->delete($this->table, array("\x69\144", "\x3d", $id))->is()) { goto j_ov4; } goto dikHX; X_MDL: if (is_file($filename)) { goto CGtiD; } goto SKLe6; bGnDT: $filename = $this->_UTF82GBK("\x2e\56\57" . $path . $name); goto X_MDL; CPt1a: goto rRXVq; goto Rjlch; Rjlch: CGtiD: goto Nw1WN; Vlt0p: $this->db->delete($this->table, array("\154\x65\166\x65\154", "\x4c\111\113\x45", "\x25\54{$id}\x2c\x25")); goto CPt1a; BtgY0: if (!$this->db->delete($this->table, array("\154\145\x76\x65\154", "\x4c\111\113\x45", "\x25\54{$id}\x2c\x25"))->is()) { goto CCcRV; } goto wufSA; q03wO: goto ykHGp; goto JTmF4; lRooZ: qA3K1: goto bGnDT; f5G3o: j_ov4: goto S6L0R; IuMpx: $path = $file["\160\141\164\150"]; goto YVYQF; IS7lI: yIIOL: goto BtgY0; SKLe6: if (is_dir($filename)) { goto yIIOL; } goto Vlt0p; sncaq: $this->db->delete($this->table, array("\151\144", "\75", $id))->is(); goto lrXnd; Q0gM1: if (!(!$path || stripos($path, "\x64\141\x74\141\57\146\x69\156\144\x65\162\57") === false || $name == null || $name == '')) { goto qA3K1; } goto sncaq; lrXnd: goto ykHGp; goto lRooZ; FUM9n: } goto OwQcC; OwQcC: J6EGb: goto orO5s; IiN_j: $ids = $request_data["\151\x64"]; goto kdmFx; P1e4_: } protected function getCurPath($foid) { goto fk3se; C6uij: $level = array_filter(explode("\x2c", $level)); goto dLEGb; a_TRs: return $this->success('', $data); goto D8jlT; dLEGb: $data = $this->db->select($this->table, array("\x69\144", "\156\x61\155\x65"))->where(array(array("\151\144", "\x49\x4e", $level), "\x41\116\x44", array("\x74\171\160\x65", "\x3d", "\146\157\x6c\x64\145\x72")))->all(); goto a_TRs; fk3se: $level = $this->db->select($this->table, "\154\x65\x76\x65\154")->where(array("\x69\x64", "\75", $foid))->get(0); goto C6uij; D8jlT: } }
