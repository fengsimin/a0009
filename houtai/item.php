<?php
//Copyright (c) 2016 iFeiwu.com
 class Item extends Ifeiwu { public function __construct() { goto CkCPH; CkCPH: if ($this->table) { goto OIsYn; } goto DUCHm; pLnpQ: OIsYn: goto p43Pu; p43Pu: parent::__construct(); goto dQBsa; DUCHm: $this->table = "\151\164\145\x6d"; goto pLnpQ; dQBsa: } protected function postPage($request_data) { goto U_wJB; sez3b: $data = array("\x6c\151\163\164" => $list, "\x74\x6f\164\141\x6c" => $total, "\160\145\162\160\141\147\145" => $perpage, "\x70\x61\147\x65" => $page); goto R34HG; T_lqe: $list = $this->db->select($this->table, $column)->where($where)->order($order)->limit(array($page * $perpage, $perpage))->all(); goto sez3b; hkPsb: $total = $this->db->select($this->table)->where($where)->count(); goto T_lqe; Ywf7l: $column = $request_data["\143\157\154\165\x6d\x6e"] ?: "\52"; goto q_pHm; NlQOR: if ($perpage > 0) { goto aoV7l; } goto a7Cid; a7Cid: $data = $this->db->select($this->table, $column)->where($where)->order($order)->all(); goto N0owd; PwLmE: $perpage = $request_data["\x70\x65\162\x70\x61\x67\x65"] ?: 0; goto NlQOR; N0owd: goto Kn8Wu; goto Tc1ok; RU7lp: $page = $request_data["\x70\141\x67\x65"] ?: 1; goto dVRzI; U_wJB: $this->_callback("\143\141\x6c\154\142\x61\143\153\120\x61\147\x65\102\145\146\157\162\145", array(&$request_data)); goto Ywf7l; leGwQ: $order = $request_data["\157\162\x64\x65\162"] ?: $this->order; goto PwLmE; FbXz0: $this->_callback("\x63\x61\x6c\x6c\142\x61\x63\153\120\141\147\x65\x41\146\164\145\x72", array(&$data)); goto QGyTT; q_pHm: $where = $request_data["\x77\150\x65\x72\x65"] ?: "\61\40\75\x20\61"; goto leGwQ; Tc1ok: aoV7l: goto RU7lp; dVRzI: $page = $page ? $page - 1 : 0; goto hkPsb; R34HG: Kn8Wu: goto FbXz0; QGyTT: return $this->success($data); goto lD920; lD920: } protected function postQuery($request_data) { goto ymRFg; E09RO: cxhqi: goto gDKVW; gDKVW: return $this->db->query($sql, $request_data["\x76\141\154\165\x65\x73"])->all(); goto sAvCw; ymRFg: $sql = $request_data["\x73\x71\x6c"]; goto YFnvx; PgJA6: $sql = str_replace("\x24\x74\x61\142\154\145", $this->prefix . $this->table, $sql); goto E09RO; YFnvx: if (!(stripos($sql, "\44\x74\x61\142\154\x65") !== false)) { goto cxhqi; } goto PgJA6; sAvCw: } protected function getOne($id, $column = null) { goto flR6V; yZREm: return $this->success($data); goto uRZxc; flR6V: $column = $column ?: "\52"; goto UYyyc; UYyyc: $data = $this->db->select($this->table, $column)->where(array("\x69\x64", "\x3d", $id))->get(); goto yZREm; uRZxc: } protected function postAdd($request_data) { goto ItkyS; vJP74: Vswlf: goto V3FnV; rKyPt: if ($id) { goto DFbB6; } goto xF2d0; Eirmq: $this->_removeFiles2($request_data["\x5f\162\x65\x6d\157\166\x65\146\151\x6c\145\x73"]); goto mi9Bn; xF2d0: return $this->error("\346\267\273\345\x8a\xa0\xe6\x95\260\xe6\x8d\256\345\xa4\xb1\350\264\245\357\274\x81"); goto LIH4Y; KQ3Uu: $udata["\x6c\x65\x76\x65\x6c"] = $this->_getLevel($pid, $id); goto vJP74; hwqq3: k4rLI: goto ia82o; GVo4W: $id = $this->db->insert($this->table, $data)->id(); goto rKyPt; aRjVz: $upload_path = $this->_bulidUploadPath($upload_path, $data); goto loPev; peEp_: $udata = array("\151\144" => $id); goto g43Z9; p7KyQ: goto KoBqS; goto hwqq3; mi9Bn: $data = $this->_bulidData($request_data); goto GqW_l; SRjnx: yZLca: goto ZVq1s; nIWf4: return $this->success("\xe6\267\273\xe5\212\xa0\346\x95\260\346\215\xae\346\x88\x90\345\x8a\237\xef\xbc\x81", array("\x69\144" => $id, "\x69\155\x61\x67\145\x5f\160\x61\164\150" => $upload_path)); goto WtU0f; GqW_l: $data["\143\164\x69\x6d\145"] = time(); goto tk6l1; L_wLF: $this->_log("\x61\144\144", array("\x74\151\x74\154\x65" => $data["\164\151\x74\x6c\x65"], "\x74\x61\142\x6c\145\137\x69\x64" => $id)); goto CieuI; E5Won: return $this->error("\xe6\267\273\xe5\x8a\240\xe6\x95\xb0\346\215\256\345\xa4\261\350\264\xa5\xef\xbc\x81"); goto p7KyQ; WtU0f: KoBqS: goto HQTzA; RtWpA: if (!($pid > 0 && in_array("\154\145\166\145\x6c", $this->fields))) { goto Vswlf; } goto KQ3Uu; V3FnV: $upload_name = $request_data["\44\x75\160\x6c\157\141\x64\137\x6e\x61\155\145"]; goto gOJbW; h1WZU: if (!($upload_name && $upload_path)) { goto yZLca; } goto uvsOC; Djzy2: $this->db->rollBack(); goto E5Won; ItkyS: $this->_callback("\x63\141\154\154\142\x61\143\153\x41\144\x64\102\145\146\x6f\x72\145", array(&$request_data)); goto Eirmq; loPev: $udata[$upload_name] = $upload_path; goto SRjnx; ZVq1s: if ($this->db->update($this->table, $udata, array("\x69\x64", "\x3d", $id))->is()) { goto k4rLI; } goto Djzy2; ia82o: $this->_callback("\x63\141\x6c\x6c\x62\x61\143\x6b\x41\144\x64\101\146\164\x65\x72", array($id, &$request_data)); goto L_wLF; g43Z9: $pid = $data["\160\151\x64"]; goto RtWpA; uvsOC: $data["\151\x64"] = $id; goto aRjVz; gOJbW: $upload_path = $request_data["\x24\x75\160\x6c\157\141\x64\x5f\x70\141\x74\x68"]; goto h1WZU; CieuI: $this->db->commit(); goto nIWf4; LIH4Y: DFbB6: goto peEp_; tk6l1: $this->db->beginTransaction(); goto GVo4W; HQTzA: } protected function postUpdate($id, $request_data) { goto RsBzn; ABhSi: N7rWy: goto ujV9U; mvd7g: if (!($upload_name && $upload_path)) { goto KJDfJ; } goto R8ASG; z0CVZ: KJDfJ: goto Pzk5K; W9ZDi: $upload_path = $request_data["\x24\x75\x70\x6c\157\x61\144\x5f\x70\x61\x74\x68"]; goto mvd7g; V26yP: if (!($pid > 0 && in_array("\x6c\145\x76\x65\x6c", $this->fields))) { goto NlMpH; } goto HOcrt; Tr368: return $this->error("\xe4\xbf\235\345\255\230\345\xa4\261\350\264\xa5\xef\274\x81"); goto r1DkF; RsBzn: $this->_callback("\143\141\154\154\142\x61\x63\x6b\x55\160\x64\141\x74\x65\102\x65\x66\157\162\x65", array(&$request_data)); goto IDSK2; r1DkF: goto IcnB7; goto ABhSi; aPahx: $data["\x75\x74\x69\x6d\x65"] = time(); goto P08NL; ymTTl: IcnB7: goto UHGKz; dM3oA: gKgvM: goto z0CVZ; C3QzW: NlMpH: goto Hg7MF; fe_94: return $this->success("\345\267\xb2\344\277\x9d\345\255\230\346\x9b\xb4\xe6\x94\271\xef\274\x81"); goto ymTTl; Hg7MF: $upload_name = $request_data["\44\x75\160\x6c\157\x61\144\x5f\156\x61\155\145"]; goto W9ZDi; eU5Qo: $data[$upload_name] = $upload_path; goto dM3oA; R8ASG: $upload_path = $this->_bulidUploadPath($upload_path, $data); goto bvlsV; bvlsV: if (!in_array($upload_name, $this->fields)) { goto gKgvM; } goto eU5Qo; Pzk5K: if ($this->db->update($this->table, $data, array("\x69\x64", "\x3d", $id))->is()) { goto N7rWy; } goto Tr368; P08NL: $pid = $data["\x70\x69\144"]; goto V26yP; IDSK2: $this->_removeFiles2($request_data["\137\x72\x65\x6d\x6f\x76\145\x66\x69\154\145\x73"]); goto M3zwJ; M3zwJ: $data = $this->_bulidData($request_data); goto aPahx; ujV9U: $this->_callback("\143\141\x6c\x6c\142\x61\x63\x6b\125\x70\144\141\164\x65\101\146\164\145\162", array($id, &$request_data)); goto tkSoa; HOcrt: $data["\154\x65\x76\145\154"] = $this->_getLevel($pid, $id); goto C3QzW; tkSoa: $this->_log("\x75\x70\x64\x61\x74\x65", array("\x74\151\x74\x6c\x65" => $data["\164\151\164\154\145"])); goto fe_94; UHGKz: } protected function postField($request_data) { goto uJrBH; xWPqp: RVt6D: goto cPl5S; uJrBH: $ids = $request_data["\151\x64"]; goto QgKFv; K9er4: goto wgORX; goto xWPqp; QgKFv: $name = $request_data["\156\141\155\x65"]; goto O7JpQ; mEEMB: wgORX: goto gluQC; VzEjn: return $this->error(); goto K9er4; O7JpQ: $value = $request_data["\x76\141\x6c\x75\x65"]; goto xg3Bo; cPl5S: return $this->success(); goto mEEMB; xg3Bo: if ($this->db->update($this->table, array($name => $value), array("\151\144", "\x49\116", $ids))->is()) { goto RVt6D; } goto VzEjn; gluQC: } protected function postCount($request_data) { goto p4zAq; tddpC: return $this->db->select($table)->where($where)->count(); goto MbhrX; q36tE: $where = $request_data["\x77\150\x65\x72\x65"] ?: "\61\x20\x3d\40\x31"; goto tddpC; p4zAq: $table = $request_data["\164\x61\x62\154\x65"] ?: $this->table; goto q36tE; MbhrX: } protected function postDelete($request_data) { goto i17I3; aA2eK: return $this->error("\xe6\x9c\211\x20" . count($error) . "\xe6\235\241\346\225\xb0\346\215\256\345\210\240\351\x99\xa4\345\xa4\xb1\350\264\245\xef\xbc\x81"); goto laPV2; aHQhS: $this->_callback("\x63\x61\x6c\154\142\x61\x63\153\x44\x65\x6c\x65\164\x65\x41\146\x74\145\x72", array(&$request_data)); goto zbVCW; AzQwc: foreach ($ids as $id) { goto MVhVH; MVhVH: $item = $this->db->select($this->table)->where(array("\x69\x64", "\75", $id))->get(); goto eYs6a; L4Bsw: goto E6Fh3; goto b6MED; Waz_9: E6Fh3: goto v2M8F; v2M8F: YKD_9: goto trEvK; mmKUg: goto YKD_9; goto L4Bsw; eYs6a: if ($this->db->delete($this->table, array("\x69\x64", "\75", $id))->is()) { goto zFHTE; } goto mHMBQ; mHMBQ: $error[] = $id; goto mmKUg; snYp0: $this->_trash($item, $request_data); goto Waz_9; b6MED: zFHTE: goto snYp0; trEvK: } goto nD4YK; wv0qa: $this->db->beginTransaction(); goto AzQwc; gZzVm: return $this->success(); goto oui_P; GHyfd: $this->_log("\x72\145\x6d\157\x76\145", array("\x74\x69\x74\x6c\x65" => count($ids))); goto gZzVm; QQIzb: if (count($error) === 0) { goto ghRKs; } goto eSvht; nD4YK: s5elZ: goto QQIzb; V6JXQ: ghRKs: goto aHQhS; qZu5V: $error = array(); goto iSXk0; eSvht: $this->db->rollBack(); goto aA2eK; oui_P: cjGgw: goto A29hi; i17I3: $this->_callback("\143\x61\154\x6c\142\141\x63\153\x44\x65\x6c\145\164\145\x42\145\146\x6f\x72\145", array(&$request_data)); goto qZu5V; laPV2: goto cjGgw; goto V6JXQ; iSXk0: $ids = $request_data["\151\x64"]; goto wv0qa; zbVCW: $this->db->commit(); goto GHyfd; A29hi: } }
