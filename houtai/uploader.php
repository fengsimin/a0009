<?php
//Copyright (c) 2016 iFeiwu.com
 class Uploader extends Ifeiwu { function __construct() { } protected function postImage($request_data) { goto kf7bv; mHhdD: $file_name_body_pre = explode("\x2c", $_POST["\146\x69\x6c\145\137\x6e\x61\x6d\x65\x5f\x62\157\x64\171\137\x70\x72\145"]); goto eW4IY; RjVVz: tb_Vg: goto K5S20; ENuNv: $file_save_path = ''; goto WWzri; S0U0j: $file_save_path = $_POST["\146\x69\154\x65\x5f\163\x61\166\145\137\160\141\x74\x68"]; goto mNBoS; sFzv4: $handle->file_new_name_body = $file_new_name_body; goto Sgpeg; De8AQ: goto Cu76h; goto mCbLc; WhS4S: $file_overwrite = $_POST["\x66\x69\x6c\x65\137\157\166\145\x72\x77\162\x69\164\x65"]; goto dN1U0; kf7bv: $_FILES["\x66\x69\x6c\145"]["\156\141\155\x65"] = $_POST["\146\151\154\x65\x5f\156\141\155\x65"]; goto lLc5g; fEAge: if (!$image_convert) { goto gPrMt; } goto DRuL3; lLc5g: $_FILES["\x66\x69\x6c\145"]["\164\171\x70\x65"] = $_POST["\146\x69\x6c\145\137\x74\x79\x70\145"]; goto JV7Zw; WWzri: O5hdB: goto Boh8h; WymgR: goto JFDta; goto fkQQ8; AfiEn: JFDta: goto L1qvB; ehOmt: if (!($file_save_path == "\x2f")) { goto O5hdB; } goto ENuNv; Zr6a8: gPrMt: goto qF7w9; NjkQU: goto tb_Vg; goto X8izk; gjMrS: $_FILES["\146\x69\154\x65"]["\x65\x72\162\x6f\162"] = $_POST["\146\x69\x6c\x65\137\x65\162\x72\x6f\162"]; goto HOBR_; MDmVT: return $this->error("\346\x97\240\346\x95\x88\xe7\x9a\x84\346\226\207\344\273\266\344\xbf\241\xe6\201\xaf\xef\274\x81"); goto De8AQ; qF7w9: if (!$file_new_name_body) { goto hXlG0; } goto sFzv4; eW4IY: $image_x = explode("\x2c", $_POST["\x69\155\x61\x67\145\137\x78"]); goto M6T4i; Hr9yo: $jpeg_quality = explode("\54", $_POST["\x6a\160\x65\x67\x5f\x71\165\141\154\x69\x74\171"]); goto PY40s; DRuL3: $handle->image_convert = $image_convert; goto Zr6a8; PY40s: if ($image_resize == 1) { goto KRFuV; } goto msHYr; O2ZF2: if (!$handle->uploaded) { goto fJ19l; } goto O7Ln3; JV7Zw: $_FILES["\146\x69\x6c\145"]["\x73\x69\172\145"] = $_POST["\146\151\x6c\145\x5f\x73\x69\172\145"]; goto gjMrS; X8izk: RHunG: goto ehOmt; T_qTm: foreach ($file_name_body_pre as $key => $prefix) { goto QCBuA; H6MbL: $handle->file_new_name_body = $file_new_name_body; goto Dly7t; PjCX0: $handle->file_name_body_pre = $prefix; goto Jg2zb; Dshy9: if ($width && $handle->image_src_x > $width) { goto oZxIW; } goto WGUwQ; Dd4sF: $handle->image_y = $height; goto r8mDr; fbhlc: $handle->file_overwrite = $file_overwrite ? true : false; goto zJAZS; Fr9ga: if (!$file_new_name_body) { goto MT3Wj; } goto H6MbL; PTCFu: $quality = $jpeg_quality[$key]; goto SAuCw; WGUwQ: $handle->image_x = $handle->image_src_x; goto A733u; xDQJc: if (!$image_convert) { goto XdtY3; } goto YDu1i; xlnVk: OjLJ2: goto Dd4sF; pQjsR: $handle->image_ratio_y = true; goto YdWKf; zJAZS: $handle->Process($upload_root . "\57" . $file_save_path); goto SD0wn; LfY_D: if ($height && $handle->image_src_y > $height) { goto OjLJ2; } goto pQjsR; A733u: goto jE3jp; goto OTEGG; pcY0I: $handle->image_resize = $image_resize ? true : false; goto PjCX0; Dly7t: MT3Wj: goto fbhlc; APpAa: $handle->image_x = $width; goto IKBUd; QCBuA: $width = $image_x[$key]; goto HnKEV; MCS0x: XdtY3: goto Dshy9; OTEGG: oZxIW: goto APpAa; uTZbX: if (!$quality) { goto v8VvA; } goto GvzSU; YDu1i: $handle->image_convert = $image_convert; goto MCS0x; r8mDr: O0HYV: goto Fr9ga; b1uXR: v8VvA: goto xDQJc; YdWKf: goto O0HYV; goto xlnVk; HnKEV: $height = $image_y[$key]; goto PTCFu; SD0wn: y4kLm: goto PT9mm; SAuCw: if (!$prefix) { goto waBdj; } goto pcY0I; Jg2zb: waBdj: goto uTZbX; IKBUd: jE3jp: goto LfY_D; GvzSU: $handle->jpeg_quality = $quality; goto b1uXR; PT9mm: } goto Cmfiz; T1xDY: ifeiwu\Loader::import("\x65\170\x74\145\x6e\x64\x2f\x55\x70\x6c\157\141\144"); goto J77fM; JId0T: $file_new_name_body = $_POST["\x66\x69\x6c\x65\137\156\145\167\x5f\x6e\141\155\145\x5f\142\157\144\x79"]; goto WhS4S; KGwsM: $handle->file_overwrite = $file_overwrite ? true : false; goto xWEYV; L1qvB: fJ19l: goto nDrt3; taDKB: if (!$quality) { goto cZLpb; } goto AyjES; msHYr: $quality = end($jpeg_quality); goto taDKB; Sgpeg: hXlG0: goto KGwsM; mCbLc: uhso4: goto T1xDY; Boh8h: return $this->success('', array("\x70\x61\x74\150" => $file_save_path, "\x69\155\141\x67\145" => $handle->file_dst_name, "\163\151\172\x65" => $handle->file_src_size, "\x77\x69\144\164\150" => $handle->image_src_x, "\150\x65\151\x67\x68\164" => $handle->image_src_y, "\164\171\160\145" => $handle->image_dst_type, "\x65\x78\x74" => $handle->file_dst_name_ext)); goto RjVVz; dN1U0: $image_resize = $_POST["\x69\155\141\147\145\137\x72\x65\x73\x69\x7a\x65"]; goto S0U0j; mNBoS: $image_convert = $_POST["\151\155\141\x67\145\137\x63\157\x6e\166\145\162\x74"]; goto Hr9yo; M6T4i: $image_y = explode("\x2c", $_POST["\x69\155\141\x67\145\x5f\x79"]); goto T_qTm; K5S20: Cu76h: goto RwEmt; O7Ln3: $upload_root = "\56\56\57"; goto JId0T; Cmfiz: gx8DH: goto AfiEn; hVo2Q: return $this->error($handle->log); goto NjkQU; xWEYV: $handle->Process($upload_root . "\x2f" . $file_save_path); goto WymgR; HOBR_: if (!empty($_FILES["\x66\x69\x6c\x65"])) { goto uhso4; } goto MDmVT; J77fM: $handle = new Upload($_FILES["\x66\151\x6c\x65"]); goto O2ZF2; AyjES: $handle->jpeg_quality = $quality; goto cBh7m; nDrt3: if ($handle->processed) { goto RHunG; } goto hVo2Q; cBh7m: cZLpb: goto fEAge; fkQQ8: KRFuV: goto mHhdD; RwEmt: } protected function postFile($request_data) { goto t_7yO; COsQH: $_FILES["\x66\x69\x6c\145"]["\164\x79\160\145"] = $_POST["\146\151\x6c\145\137\x74\x79\160\x65"]; goto SRANT; wwPAQ: Uuqoz: goto ui8F3; N7IW0: mkdir($temp_dir, 511, true); goto wwPAQ; RnpuC: $resumableFilename = $this->_UTF82GBK($_POST["\162\x65\x73\165\x6d\x61\142\154\x65\106\151\154\145\156\x61\155\x65"]); goto EmJ_J; SRANT: $_FILES["\146\151\154\x65"]["\x73\151\172\145"] = $_POST["\x66\x69\154\145\x5f\x73\151\x7a\x65"]; goto qEjyu; EEIzi: $_FILES["\146\x69\x6c\145"]["\x6e\x61\x6d\145"] = $_POST["\x66\x69\154\145\x5f\156\x61\x6d\x65"]; goto COsQH; tcOzP: $dest_file = $temp_dir . "\x2f" . $resumableFilename . "\x2e\x70\141\x72\x74" . $resumableChunkNumber; goto GWp5n; t_7yO: $save_path = "\x2e\56\57" . $this->_UTF82GBK($_POST["\163\141\x76\145\137\x70\141\x74\x68"]); goto RnpuC; qEjyu: $_FILES["\x66\x69\x6c\x65"]["\x65\x72\x72\x6f\162"] = $_POST["\146\151\x6c\145\x5f\x65\162\162\157\162"]; goto Jl28U; M0CIC: $this->_debug("\105\x72\162\x6f\162\x20\x73\x61\x76\x69\x6e\147\40\x28\x6d\x6f\x76\145\137\x75\160\x6c\157\141\x64\145\144\x5f\146\151\x6c\145\x29\40\143\x68\165\x6e\153\x20" . $resumableChunkNumber . "\40\x66\x6f\162\x20\x66\x69\154\145\x20" . $resumableFilename); goto JMnyU; ui8F3: if (!move_uploaded_file($file["\x74\x6d\160\137\x6e\x61\x6d\x65"], $dest_file)) { goto PTCik; } goto UN5Kz; GWp5n: if (is_dir($temp_dir)) { goto Uuqoz; } goto N7IW0; pDqgW: JXf9m: goto zh5Sb; zh5Sb: $temp_dir = $save_path . "\57" . $resumableIdentifier; goto tcOzP; AitmG: goto W9w1f; goto RbDZ_; MQZG2: if (!($file["\145\162\x72\157\x72"] != 0)) { goto JXf9m; } goto D0EcX; JMnyU: W9w1f: goto Byn5p; RbDZ_: PTCik: goto M0CIC; iFbqi: $resumableIdentifier = $_POST["\162\x65\x73\165\155\141\x62\154\x65\111\144\x65\156\x74\x69\146\x69\145\x72"]; goto EEIzi; Jl28U: $file = $_FILES["\x66\151\x6c\145"]; goto MQZG2; UN5Kz: $this->_createFileFromChunks($save_path, $temp_dir, $resumableFilename, $_POST["\x72\145\163\165\x6d\x61\x62\154\x65\x43\150\165\156\153\x53\151\x7a\x65"], $_POST["\x72\x65\163\x75\x6d\x61\142\x6c\x65\x54\157\x74\x61\x6c\x53\151\x7a\145"]); goto AitmG; EmJ_J: $resumableChunkNumber = $_POST["\x72\145\163\165\155\x61\x62\x6c\x65\103\x68\x75\156\153\x4e\165\x6d\x62\145\162"]; goto iFbqi; D0EcX: $this->_debug("\x65\162\x72\x6f\x72\x20" . $file["\145\162\162\x6f\162"] . "\40\151\156\x20\146\x69\154\145\40" . $resumableFilename); goto pDqgW; Byn5p: } protected function getFile() { goto rgR15; de5bm: $resumableChunkNumber = $_GET["\x72\145\x73\x75\x6d\x61\142\154\x65\x43\150\165\156\153\116\x75\155\x62\145\x72"]; goto wGiR7; wGiR7: $resumableIdentifier = $_GET["\162\145\x73\x75\x6d\141\x62\154\145\111\x64\145\x6e\x74\x69\x66\151\x65\162"]; goto HgW_H; p11Vz: return 404; goto YYSVy; HgW_H: $temp_dir = $save_path . "\x2f" . $resumableIdentifier; goto ocmcC; rgR15: $save_path = "\x2e\56\x2f" . $this->_UTF82GBK($_GET["\163\141\166\x65\x5f\x70\141\x74\150"]); goto DsU7E; f0Mjc: if (file_exists($chunk_file)) { goto nOtqJ; } goto p11Vz; DsU7E: $resumableFilename = $this->_UTF82GBK($_GET["\x72\x65\163\165\x6d\141\x62\154\x65\106\151\154\x65\156\x61\x6d\x65"]); goto de5bm; YYSVy: goto N2043; goto MmkJ3; h0k4U: N2043: goto K2lHD; m9nf8: return 202; goto h0k4U; ocmcC: $chunk_file = $temp_dir . "\57" . $resumableFilename . "\x2e\160\141\x72\x74" . $resumableChunkNumber; goto f0Mjc; MmkJ3: nOtqJ: goto m9nf8; K2lHD: } private function _createFileFromChunks($save_path, $temp_dir, $fileName, $chunkSize, $totalSize) { goto IVDnO; DZVc9: return false; goto it_rX; prShu: JwI3F: goto ArJs9; U2zio: JC4c1: goto s7aF_; s7aF_: $i = 1; goto prShu; rLy52: LJOcX: goto J3cnF; yKOny: Ms0m8: goto K0kBm; RipHT: $this->_debug("\x63\141\x6e\x6e\157\164\40\x63\x72\x65\x61\x74\145\40\164\150\x65\40\144\x65\163\164\151\x6e\141\x74\151\x6f\156\x20\146\151\x6c\145"); goto DZVc9; it_rX: goto Vh4JZ; goto U2zio; wicQO: if (($fp = fopen($save_path . "\x2f" . $fileName, "\x77")) !== false) { goto JC4c1; } goto RipHT; IVDnO: $total_files = 0; goto wmuSs; gfWfF: $this->_rrmdir($temp_dir . "\x5f\x55\x4e\x55\x53\105\104"); goto UZGEx; aFEtZ: if (rename($temp_dir, $temp_dir . "\x5f\x55\116\125\x53\x45\104")) { goto nFdb7; } goto q5_AQ; ArJs9: if (!($i <= $total_files)) { goto bZvSb; } goto X1Mu7; ltuiB: bZvSb: goto xOABA; q5_AQ: $this->_rrmdir($temp_dir); goto mlFBz; GIC9_: nFdb7: goto gfWfF; UZGEx: OUq2U: goto yKOny; mlFBz: goto OUq2U; goto GIC9_; wmuSs: foreach (scandir($temp_dir) as $file) { goto gtLLn; gtLLn: if (!(stripos($file, $fileName) !== false)) { goto b6bX8; } goto cF8EK; cF8EK: $total_files++; goto yDqV_; yDqV_: b6bX8: goto gO_oF; gO_oF: qQToK: goto S5fIS; S5fIS: } goto rLy52; HUGJn: YB01e: goto t5XqZ; t5XqZ: $i++; goto wnfms; X1Mu7: fwrite($fp, file_get_contents($temp_dir . "\x2f" . $fileName . "\x2e\160\141\162\164" . $i)); goto HUGJn; xOABA: fclose($fp); goto pHnme; wnfms: goto JwI3F; goto ltuiB; J3cnF: if (!($total_files * $chunkSize >= $totalSize - $chunkSize + 1)) { goto Ms0m8; } goto wicQO; pHnme: Vh4JZ: goto aFEtZ; K0kBm: } private function _rrmdir($dir) { goto bYtqo; XAj_x: reset($objects); goto s552k; hXcm_: RWaAM: goto XAj_x; bYtqo: if (!is_dir($dir)) { goto AIHAm; } goto xL2uj; OQF1E: AIHAm: goto U9qh3; xL2uj: $objects = scandir($dir); goto XGMQ3; XGMQ3: foreach ($objects as $object) { goto ghP3R; exYfr: j7w3u: goto WAUmn; V2YOr: U43xV: goto Vyxk4; zf79c: goto j7w3u; goto V2YOr; V7CzV: if (filetype($dir . "\x2f" . $object) == "\144\151\x72") { goto U43xV; } goto i2xJf; i2xJf: unlink($dir . "\57" . $object); goto zf79c; ghP3R: if (!($object != "\x2e" && $object != "\x2e\x2e")) { goto GM2SN; } goto V7CzV; Vyxk4: $this->_rrmdir($dir . "\57" . $object); goto exYfr; vig2K: cybg8: goto qQlWl; WAUmn: GM2SN: goto vig2K; qQlWl: } goto hXcm_; s552k: rmdir($dir); goto OQF1E; U9qh3: } }
